---
import BaseLayout from '../layouts/BaseLayout.astro';
import Header from '../components/Header.astro';
import Footer from '../components/Footer.astro';
import HeroScene from '../components/HeroScene.astro';
import PortfolioCard from '../components/PortfolioCard.astro';
import BlogPostCard from '../components/BlogPostCard.astro';
import { getCollection, type CollectionEntry } from 'astro:content';
import { siteConfig } from '../config/site.config';

// Featured ポートフォリオを取得
const allPortfolio = await getCollection('portfolio');
const featuredPortfolio = allPortfolio
  .filter((p: CollectionEntry<'portfolio'>) => p.data.featured)
  .sort((a: CollectionEntry<'portfolio'>, b: CollectionEntry<'portfolio'>) => b.data.date.valueOf() - a.data.date.valueOf())
  .slice(0, 3);

// 最新ブログ記事を取得
const allPosts = await getCollection('posts', (entry: CollectionEntry<'posts'>) => !entry.data.draft);
const latestPosts = allPosts
  .sort((a: CollectionEntry<'posts'>, b: CollectionEntry<'posts'>) => b.data.date.valueOf() - a.data.date.valueOf())
  .slice(0, 3);
---

<BaseLayout title={`${siteConfig.name} - ${siteConfig.title}`}>
  <Header transparent />

  <main id="main-content">
    <HeroScene>
      <h1 class="text-5xl md:text-7xl font-bold text-white mb-4 text-center drop-shadow-lg">
        {siteConfig.name}
      </h1>
      <p class="text-xl md:text-2xl text-white/80 text-center max-w-2xl px-4 md:px-6 mb-8">
        {siteConfig.title}
      </p>
      <div class="flex flex-col sm:flex-row gap-4">
        <a
          href="/portfolio"
          class="btn-primary"
        >
          View Work
        </a>
        <a
          href="/about"
          class="px-8 py-3 bg-white/10 text-white font-semibold rounded-lg hover:bg-white/20 transition-colors backdrop-blur-sm text-center"
        >
          About Me
        </a>
      </div>
    </HeroScene>

    <!-- Featured Work Section -->
    <section class="py-20 bg-nightwalk-dark">
      <div class="section-container">
        <div class="flex items-center justify-between mb-12">
          <h2 class="text-3xl md:text-4xl font-bold text-white">
            Featured Work
          </h2>
          <a
            href="/portfolio"
            class="text-nightwalk-orange hover:underline font-medium"
          >
            View All →
          </a>
        </div>

        <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-6 max-w-6xl mx-auto">
          {
            featuredPortfolio.map((project) => (
              <PortfolioCard
                title={project.data.title}
                description={project.data.description}
                slug={project.slug}
                image={project.data.image}
                tags={project.data.tags}
                featured={project.data.featured}
              />
            ))
          }
        </div>
      </div>
    </section>

    <!-- Latest Posts Section -->
    <section class="py-20 bg-gradient-to-b from-nightwalk-dark to-nightwalk-purple/50">
      <div class="section-container">
        <div class="flex items-center justify-between mb-12">
          <h2 class="text-3xl md:text-4xl font-bold text-white">
            Latest Posts
          </h2>
          <a
            href="/blog"
            class="text-nightwalk-orange hover:underline font-medium"
          >
            View All →
          </a>
        </div>

        <div class="max-w-3xl mx-auto space-y-6">
          {latestPosts.map((post) => (
            <BlogPostCard post={post} maxTags={2} locale="ja-JP" />
          ))}
        </div>
      </div>
    </section>

    <!-- Contact CTA Section -->
    <section class="py-20 bg-nightwalk-purple">
      <div class="section-container text-center">
        <h2 class="text-3xl md:text-4xl font-bold text-white mb-6">
          Let's Work Together
        </h2>
        <p class="text-xl text-white/70 mb-8 max-w-2xl mx-auto">
          Have a project in mind? I'd love to hear about it.
        </p>
        <a
          href="/about#contact"
          class="inline-flex items-center gap-2 px-8 py-3 bg-white text-nightwalk-dark font-semibold rounded-lg hover:bg-white/90 transition-colors"
        >
          Get in Touch
        </a>
      </div>
    </section>
  </main>

  <Footer />
</BaseLayout>
